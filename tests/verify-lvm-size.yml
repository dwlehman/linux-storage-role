---
- set_fact:
    lv_info: "{{ ansible_facts.lvm.lvs[device_name] }}"

- set_fact:
    vg_info: "{{ ansible_facts.lvm.vgs[lvm_vg] }}"

- set_fact:
    modified_size: "{{ parsed_size.lvm|replace('g' ,'') }}"

  # This is problematic when size == '1 G'
- name: Verify specified size
  assert:
    that: (lv_info.size_g|float) == (modified_size|float)
    msg: "The playbook ran with {{ modified_size|float }}, but ansible lvs info returned {{ lv_info.size_g|float}}"
  when: size is not search("%")

- name: Verify default size
  assert:
    that: vg_info.free_g == "0"
    msg: "The remaining free space in {{ lvm_vg }} is not completely used up."
  when: size == "100%FREE"
